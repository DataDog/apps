name: publish
on:
    release:
        types: [created]
jobs:
    publish:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v1
              with:
                  node-version: 14.14.0
                  registry-url: 'https://registry.npmjs.org'
                  scope: '@datadog'
            # I'm hoping this will work as part of the publish process. We will need to monitor closely, and maybe run manually but that will require admin privledges to the datadog npm account.
            - run: npm deprecate "@datadog/ui-apps-sdk" "@datadog/ui-apps-sdk has been renamed to "@datadog/ui-extensions-sdk, please rename accordingly. Future updates will only be published under the new name."
              env:
                  NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
            - run: yarn
            - run: yarn publish
              env:
                  NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
